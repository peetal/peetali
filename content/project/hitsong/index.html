<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Building API for Predicting Mando-pop Popularity</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="75351660-c007-42aa-8ae7-54f0dcbe197c" class="page sans"><header><h1 class="page-title">Building API for Predicting Mando-pop Popularity</h1></header><div class="page-body"><p id="24a69e2b-d6a8-471a-b319-036fe640724b" class="">Authors: Yufei Zhao, Peeta Li</p><nav id="f004c548-0232-4a03-825d-a1cc59a8d5ee" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3eeb0cbc-eedb-4eaf-bef5-e914818cf513">1. Overview: The problem and solution </a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c5dd7ad8-653d-4311-811b-e80654a6b412">The Problem</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#94db6aec-c3bb-441c-8870-9bc95db6b0e2">The Solution </a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#bf87b2ee-342e-499e-929a-b0ad64910074">2. Get-ready: explore data, benchmark baseline model</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e23a1ac0-cfe7-42c3-8d30-0e24a676e39d">Query data with Spotify API</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6d8309f5-0639-4ba0-9601-bdd1be1bf4dc">Benchmark baseline model &amp; Diagnostic for bias and variance</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b11034e8-e845-49c4-ad00-6b21cf38c353">3. The predictive model </a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b6bb6ee8-9daa-425f-b8db-fa3f48e210bd">Web-scrap data</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#2701d9e9-2c7f-470f-b831-d38865afad91">Extract mel spectrogram</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#68d77646-1095-476a-a3fa-25fd47aa88b3">Obtain music tag</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#12bc60ef-00d2-4ad5-aa08-45c3b99160d4">Model training and testing</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#29eb5fe6-82d4-4e78-a70f-5fc8b3baebd1">Model performance</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#33605645-da7d-42fe-9d1d-43d7effb1c5f">4. Develop API</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b2970380-0896-436d-9ddd-43a5a21b3c77">Reference</a></div></nav><h2 id="3eeb0cbc-eedb-4eaf-bef5-e914818cf513" class="">1. Overview: The problem and solution </h2><h3 id="c5dd7ad8-653d-4311-811b-e80654a6b412" class="">The Problem</h3><ul id="d9fb2af8-7de0-4c89-ae2a-e5ff3a01159c" class="bulleted-list"><li>Automatic composition models are commonly used for Mando-pop music productions, and thus requires a way to identify potential trending songs from a batch of auto-produced songs. This can be accomplished by so called hit song prediction model. </li></ul><ul id="28e45ce7-11b2-4124-b23b-b59099c093f3" class="bulleted-list"><li>We review 10+ papers on hit song prediction models through literature search. Although various models can be found through Googling, these models usually have two limitations: <em>i</em>) Such models were trained mostly with western music, such as English, French, Spanish songs, leaving its use on Mando-pop questionable and <em>ii</em>) Such models are usually presented in a paper or conference abstract, with little sharing codes via Github repository,  and no model has been fully wrapped up for easy implement.</li></ul><h3 id="94db6aec-c3bb-441c-8870-9bc95db6b0e2" class="">The Solution </h3><ul id="12fd2441-0dc0-48af-b3a4-e3b66fae390a" class="bulleted-list"><li>We adopted the structures of an <a href="https://arxiv.org/pdf/1710.10814.pdf">inception convolutional neural network (CNN) hit song prediction model</a> that takes audio features (i.e., Mel Spectrogram) as input for popularity prediction. More of the model details can be found <a href="">here</a>. We then trained our model with all Mando-pop songs scrapped from the preview MP3 URL obtained with <a href="https://developer.spotify.com/">Spotify API</a>. For the implementation of our trained model, we developed a REST API using FLASK to make our model easily accessible (as shown below). Our trained model can be found <a href="https://github.com/Irisfee/spotify_analysis">here</a> and our API can be accessed <a href="https://github.com/Irisfee/popularity_predict_api">here</a>.</li></ul><figure id="00db7035-e3ff-4ef1-8588-3cdba69de8a0" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/demo.gif"><img style="width:576px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/demo.gif"/></a></figure><ul id="6f2fac05-48fd-4599-b19c-540e0e5bc590" class="bulleted-list"><li>We accomplished this through the pipeline shown below. We will debrief each step of the pipeline in sections down below.</li></ul><figure id="69eaa767-c6e0-4e10-bb24-878bf1853419" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.53.07_PM.png"><img style="width:576px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.53.07_PM.png"/></a></figure><h2 id="bf87b2ee-342e-499e-929a-b0ad64910074" class="">2. Get-ready: explore data, benchmark baseline model</h2><h3 id="e23a1ac0-cfe7-42c3-8d30-0e24a676e39d" class="">Query data with Spotify API</h3><ul id="dafd88fa-c714-450b-baed-ed43a1cc55c1" class="bulleted-list"><li>We wrote a class to extract all 90212 Mandopop songs, after removing duplicates, and their related information. We accomplished this by: <p id="58451487-5f8f-46b8-a051-90ac8dc6aba8" class="">1. querying all the artists within &quot;mandopo&quot; genre</p><p id="5b28e5ed-5703-4271-a96c-cbf8885da864" class="">2. querying all the albums of each artist</p><p id="a6e1ddb8-7e0a-427b-9cbc-29f744c5cff5" class="">3. querying all the songs within each album,</p><p id="c07f0dad-a927-4fe9-b68e-7eb64a624b4a" class="">4. removing duplicate based on same preview URL (which means the same song).</p></li></ul><ul id="37b81c00-dd99-4925-9f62-87311f3b08a0" class="bulleted-list"><li>For each song, we collected its URL (for downloading the preview song clip),  <a href="https://developer.spotify.com/documentation/web-api/reference/#endpoint-get-audio-features">Spotify-provided audio features </a>(e.g., danceability, loudness), and its popularity score. The popularity score of a song is a value between 0 and 100, with 100 being the most popular. The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are. </li></ul><figure id="6b302c6d-b9e3-42a4-933f-c4d0abe28fbb" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Untitled.png"><img style="width:576px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Untitled.png"/></a></figure><h3 id="6d8309f5-0639-4ba0-9601-bdd1be1bf4dc" class="">Benchmark baseline model &amp; Diagnostic for bias and variance</h3><ul id="349c541d-1a31-464f-b4a8-fd6140f506c0" class="bulleted-list"><li>We built a baseline linear models using the Spotify-provided audio features (e.g., danceability, loudness) for hit song prediction (popularity score) with two aims. First, we want to test the feasibility of using audio features to predict popularity. Second, we want to benchmark the baseline model performance so that we could evaluate our more sophisticated model later on.</li></ul><ul id="100693cc-cf15-4bdc-a878-7d11eec8dae4" class="bulleted-list"><li>With a cross-validation framework, the averaged MSE for validation folds were around 89, and the predictive accuracy, as measured by Spearman correlation coefficient between actual and predicted popularity scores reached 0.27. </li></ul><ul id="281fee2e-86ca-49b7-9bc0-1cd7dc326f1c" class="bulleted-list"><li>We did a quick diagnostic of the error, which in principle consists 1) Bias, 2) Variance, and 3) irreducible error. As shown in the figure below, test error does not drop as training sample size increases, and test error is already very close to training error, suggesting that the baseline model is under-fitting and has high bias. Thus a direct solution is to increases the number of audio features. Of course, this goes beyond what Spotify-available features, and we used audio data preprocessing to quantify our predictive audio features, as shown in the next section. </li></ul><figure id="be0a9aa0-34e3-47d2-92f4-364ff97d2d88" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Diagnostic_.png"><img style="width:432px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Diagnostic_.png"/></a></figure><h2 id="b11034e8-e845-49c4-ad00-6b21cf38c353" class="">3. The predictive model </h2><h3 id="b6bb6ee8-9daa-425f-b8db-fa3f48e210bd" class="">Web-scrap data</h3><ul id="a00375d9-c8d1-4eb0-ad7f-dc6efebb8cca" class="bulleted-list"><li>Using the preview-URLs queried using Spotify API, we web-scraped the preview-mp3 (~30s long) from those URLs. </li></ul><figure id="2fabbd50-9f34-4b22-b817-622dbcbd517a" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.18.06_PM.png"><img style="width:384px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.18.06_PM.png"/></a></figure><h3 id="2701d9e9-2c7f-470f-b831-d38865afad91" class="">Extract mel spectrogram</h3><ul id="3d1e6d1d-8dc8-4b63-ac94-8de79ca1ac9f" class="bulleted-list"><li>Mel (Melody) spectrograms contains information across three aspects. First, using STFT (Short-Time Fourier Transform), mel-spectrogram has time-frequency representation. Second, it represents amplitude in a perceptually-relevant manner by amplitude-db conversion. Most importantly, it represents frequency also in a perceptually-relevant manner by converting frequency to the mel scale. Thus, the mel-spectrogram includes ample perceptually relevant audio features for our deep learning mode. </li></ul><figure id="b136305e-23b3-49a2-ba75-68ce1ea8b238" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/mel_spec.png"><img style="width:480px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/mel_spec.png"/></a></figure><h3 id="68d77646-1095-476a-a3fa-25fd47aa88b3" class="">Obtain music tag</h3><ul id="0ab249a3-4d30-4bb5-a91b-673e90da1a41" class="bulleted-list"><li>Using a pre-trained CNN model described <a href="http://mac.citi.sinica.edu.tw/~yang/pub/liu16mm.pdf">here</a>. We computed the music tag loading for each mp3 clips. These music tag loadings will be part of the input to our final model, along with the mel spectrogram. </li></ul><ul id="3e0e4156-e52e-4629-b77e-bf287aba2f94" class="bulleted-list"><li>Below are the structure of this auto-tagging CNN and a sample result for a mp3 clip&#x27;s tag loadings. </li></ul><div id="a13dfde1-e1b6-4621-b973-fe7c7c58c5c4" class="column-list"><div id="2b7c3462-1713-47bb-ba06-0eebfd69a100" style="width:50%" class="column"><figure id="11c7e285-45a0-4e95-9e78-cb0a6f1aa9b0" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.48.57_PM.png"><img style="width:480px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.48.57_PM.png"/></a></figure></div><div id="7c82695c-c7cb-40bf-a54a-23f3b2e75a60" style="width:50%" class="column"><figure id="e64f4e37-682c-4ed8-b4a7-320b494497a8" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/tag.png"><img style="width:480px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/tag.png"/></a></figure></div></div><h3 id="12bc60ef-00d2-4ad5-aa08-45c3b99160d4" class="">Model training and testing</h3><ul id="4aedbed8-e5c6-47d4-8473-dddc45248f6a" class="bulleted-list"><li>We reviewed 10+ papers on hit song prediction models. We chose an <a href="https://arxiv.org/pdf/1710.10814.pdf">inception CNN</a> since its has the highest predict accuracy among all models and it can use the popularity score we extracted from Spotify API for prediction. The structure of the model can be seen below. The model outputs a prediction score of popularity.</li></ul><ul id="dae836fe-a8f1-4056-8c13-cd49e81bc481" class="bulleted-list"><li>The mel-spectrogram features of the mp3 clip can only capture the low level information of a song. Thus, we want to incorporate the higher level information, tag loadings, to improve the performance. To do this, we passed the tag loadings for each song through a fully-connected DNN and yield another prediction score of popularity.</li></ul><ul id="eab10d18-ceac-443d-acc9-28831d7bfac4" class="bulleted-list"><li>We took a weighted averaged of the two prediction score and yielded the final popularity prediction score.</li></ul><ul id="eb8d99b4-0d54-4fc7-9e39-bbf5fd2c1bd2" class="bulleted-list"><li>We trained the model for 10 epochs before the validation loss started to increase.</li></ul><p id="45000d24-4de9-4ddc-8131-a375c16a9791" class="">
</p><figure id="2a9b6c47-5af8-4aec-a511-6a0bd4466fd8" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.53.50_PM.png"><img style="width:768px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.53.50_PM.png"/></a></figure><h3 id="29eb5fe6-82d4-4e78-a70f-5fc8b3baebd1" class="">Model performance</h3><ul id="20a4b3ad-d24d-445f-a2a2-aece84493db0" class="bulleted-list"><li>With more abundant audio features, we decreased the MSE from the baseline MSE = 89 now to MSE = 82. Likewise, we improved the model predictive accuracy, as measured by Spearman correlation coefficient from 0.27 to 0.34. </li></ul><h2 id="33605645-da7d-42fe-9d1d-43d7effb1c5f" class="">4. Develop API</h2><ul id="441d7f8e-56d3-4498-9561-aef6d99e187f" class="bulleted-list"><li>We wrapped up our model and developed a REST API using FLASK, which yields the gif demo presented at the start of this post. </li></ul><ul id="b9995f70-d66b-409d-b88e-d3963e8daa97" class="bulleted-list"><li>After loading the mp3 clip, our API will produce two estimated scores: 1) the predicted Spotify popularity score, 2) the percentile of popularity among all Mando-pop songs on Spotify.</li></ul><ul id="ede6212a-8fbb-429d-8eb2-8d88b6f5758b" class="bulleted-list"><li>The detail usage of the API and the codes can be found <a href="https://github.com/Irisfee/popularity_predict_api">here</a>.</li></ul><figure id="6c3bdf74-12db-41ab-b7bd-df65a749f977" class="image"><a href="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.55.06_PM.png"><img style="width:432px" src="Building%20API%20for%20Predicting%20Mando-pop%20Popularity%2000db7035e3ff4ef185883cdba69de8a0/Screen_Shot_2021-08-22_at_7.55.06_PM.png"/></a></figure><h1 id="b2970380-0896-436d-9ddd-43a5a21b3c77" class="">Reference</h1><p id="cb971c87-6b24-4c8f-a1b4-23ff0ba15d58" class="">[1] Yu, L. C., Yang, Y. H., Hung, Y. N., &amp; Chen, Y. A. (2017). Hit song prediction for pop music by siamese cnn with ranking loss. arXiv preprint arXiv:1710.10814. <a href="https://github.com/OckhamsRazor/HSP_CNN">repo</a></p><p id="a4c89bce-9eff-4e27-bb48-d8b1a1666b6a" class="">[2] Liu, J. Y., &amp; Yang, Y. H. (2016, October). Event localization in music auto-tagging. In Proceedings of the 24th ACM international conference on Multimedia (pp. 1048-1057).</p></div></article></body></html>